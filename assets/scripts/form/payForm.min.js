function payWithPaystack(){cust_amount=$("#pay_amount").val().split(" "),cust_amount=100*parseInt(cust_amount[1]),cust_email=$("form[name=paymentForm] .body #pay_email").val();var e=PaystackPop.setup({key:"pk_live_056157b8c9152eb97c1f04b2ed60e7484cd0d955",email:cust_email,amount:cust_amount,currency:"GHS",split_code:"SPL_U6mW80wZNH",metadata:{custom_fields:[{display_name:"Mobile Number",variable_name:"mobile_number",value:$("#pay_phone").val()},{display_name:"Customer's Name",variable_name:"customer_name",value:$("#pay_fullname").val()},{display_name:"School Name",variable_name:"school_name",value:$("#school_admission_case #school_select option:selected").html()}]},callback:function(e){payment_received=!0,message="Transaction was made successfully",messageBoxTimeout("paymentForm",message,"success"),alert_box(message,"success",3.5),displayAdmissionForm(e.reference),sendSMS(e.reference),passPaymentToDatabase(e.reference),transaction_reference=e.reference,trackKeeper=setInterval(reCheck,3500)},onClose:function(){alert_box("Transaction has been canceled by user","secondary",10)}});e.openIframe()}function displayAdmissionForm(e){$("#ad_transaction_id").val(e),$("#ad_index").val($("#student_index_number").val()),$("#ad_index").blur(),$("#admission button[name=continue]").prop("disabled",!1).click()}async function trackTransactions(e=""){return reference_parsed||(fullname=$("#pay_fullname").val(),email=$("#pay_email").val(),phone=$("#pay_phone").val(),amount=$("#pay_amount").val().split(" "),amount=amount[1],deduction=parseFloat(((.0195+Number.EPSILON)*parseInt(amount)).toFixed(2)),school_name=$("#school_admission_case #school_select option:selected").html(),school_id=$("#student #school_admission_case label #school_select").val(),school_id>0&&(dataString="transaction_id="+e+"&contact_number="+phone+"&school="+school_id+"&amount="+amount+"&deduction="+deduction+"&contact_email="+email+"&contact_name="+fullname+"&submit=trackTransaction",await $.ajax({url:$("form[name=paymentForm]").attr("action"),type:"POST",dataType:"text",data:dataString,cache:!1,timeout:8e3,success:function(a){a.includes("success")?($("#ad_transaction_id").val(e),reference_parsed=!0,message="Reference ID confirmed",alert_box(message,"success",3.5)):a.includes("already-exist")&&(reference_parsed=!0)},error:function(e,a){e=JSON.parse(JSON.stringify(e)),message=e.statusText,time=5,"timeout"==a&&(message="Connection was timed out due to a slow network. Please try again later",time=8),$("#pay_fullname, #pay_email, #pay_phone").prop("disabled",!0),$("#pay_reference").prop("disabled",!1),messageBoxTimeout("paymentForm",message,"error",time),exit(1)}}))),reference_parsed}function reCheck(){""!=transaction_reference&&(++retry_counter,reference_parsed=trackTransactions(transaction_reference)),reference_parsed?(reference_parsed=!1,payment_received=!1,transaction_reference="",retry_counter=0,clearInterval(trackKeeper)):3!=retry_counter||reference_parsed||alert_box("Slow network detected","warning",8)}function sendSMS(e){phone=$("#pay_phone").val().replace("+",""),message="Your payment was successful. Your transaction reference is "+e+". You can use this if you experience a problem while filling your form and would want to try again",dataString="submit=sendTransaction&phone="+phone+"&message="+message,$.ajax({url:"sms/sms.php",data:dataString,type:"POST",dataType:"json",timeout:8e3,success:function(a){response1=JSON.parse(JSON.stringify(a)),"success"==response1.status?alert_box("SMS sent successfully","success"):alert_box("An sms could not be sent, but payment was successful. Your transaction reference is "+e+". Save this value at a safe place","warning",10)},error:function(a,t){alert_box("An error occured while sending sms, but payment was successful. Your transaction reference is "+e+". Save this value at a safe place","warning",15),"timeout"==t?alert_box("Connection was timed out due to a slow network. Please try again later","danger"):alert_box(a.responseText,"danger")}})}async function passPaymentToDatabase(e){fullname=$("#pay_fullname").val(),email=$("#pay_email").val(),phone=$("#pay_phone").val(),amount=$("#pay_amount").val().split(" "),amount=amount[1],deduction=parseFloat(((.0195+Number.EPSILON)*parseInt(amount)).toFixed(2)),school_name=$("#school_admission_case #school_select option:selected").html(),school_id=$("#student #school_admission_case label #school_select").val(),school_id>0&&(dataString="transaction_id="+e+"&contact_number="+phone+"&school="+school_id+"&amount="+amount+"&deduction="+deduction+"&contact_email="+email+"&contact_name="+fullname+"&submit=add_payment_data",await $.ajax({url:$("form[name=paymentForm]").attr("action"),type:"POST",dataType:"text",data:dataString,cache:!1,timeout:8e3,success:function(e){e.includes("success")?(cont=e.split("-")[1],html="<p style='text-align: center; font-size: small; color: #666'>Finding trouble? Contact the admin via <a href='tel:"+cont+"' style='color: blue'>"+cont+"</a></p>",$("#admission #form_footer").html(html),message="Transaction ID confirmed",alert_box(message,"success",3.5)):"database_send_error"==e?(form_name="paymentForm",message="Admin contact could not be retrieved",message_type="warning",alert_box(message,message_type)):(form_name="paymentForm",message="An error prevented the admin contact to be retrieved",message_type="warning",time=10,alert_box(message,message_type))},error:function(e,a){message="Error communicating with server. Validation failed on first try","timeout"==a&&(message="Connection was timed out due to a slow network. Please try again later"),$("#pay_fullname, #pay_email, #pay_phone").prop("disabled",!0),$("#pay_reference").prop("disabled",!1),alert_box(message,"warning"),exit(1)}}))}reference_parsed=!1,payment_received=!1,transaction_reference="",retry_counter=0,trackKeeper=null,$("form[name=paymentForm]").submit(function(){form_name="paymentForm",""==$("section#trans #pay_reference").val()?($("#pay_reference").prop("disabled",!0),$("#pay_fullname, #pay_email, #pay_phone").prop("disabled",!1),""===$("#pay_fullname").val()||null===$("pay_fullname").val()?messageBoxTimeout("paymentForm","Please provide your fullname","error"):""===$("#pay_email").val()||null===$("pay_email").val()?messageBoxTimeout("paymentForm","Please provide your email","error"):""===$("#pay_phone").val()||null===$("pay_phone").val()?messageBoxTimeout("paymentForm","Please provide your phone number","error"):payWithPaystack()):($("#pay_fullname, #pay_email, #pay_phone").prop("disabled",!0).val(""),school_id=$("#student #school_admission_case label #school_select").val(),ref=$("section#trans #pay_reference").val(),dataString="reference_id="+ref+"&submit=checkReference&school_id="+school_id,$.ajax({url:$("form[name=paymentForm]").attr("action"),data:dataString,type:"POST",dataType:"text",cache:!1,timeout:8e3,beforeSend:function(){message=loadDisplay({size:"small",animation:"anim-fade anim-swing"}),messageType="load",time=0,messageBoxTimeout(form_name,message,messageType,time)},success:function(e){e.includes("success")?($("form[name=admissionForm] #ad_transaction_id").val(ref),cont=e.split("-")[1],html="<p style='text-align: center; font-size: small; color: #666'>Finding trouble? Contact the admin via <a href='tel:"+cont+"' style='color: blue'>"+cont+"</a></p>",$("#admission #form_footer").html(html),$("#ad_index").val($("#student_index_number").val()),$("#ad_index").blur(),$("button[name=continue]").prop("disabled",!1).click(),$("#admission").removeClass("no_disp"),messageType="success",message="Verification was successful",time=5):"ref_expired"==e?(message="Sorry! This reference id has expired. Please make a new payment to continue",messageType="error",time=5):"error"==e?(message="Reference ID entered is incorrect. Please enter a valid id to continue",messageType="error",time=5):(message=e,messageType="error",time=0),messageBoxTimeout(form_name,message,messageType,time)},error:function(e,a){message="Error communicating with server. Please check your internet connection and try again later","timeout"===a&&(message="Connection was timed out due to a slow network. Please try again later"),messageType="error",time=5,messageBoxTimeout(form_name,message,messageType,time)}}))}),$("#paymentFormButton").click(function(){$("form[name=paymentForm]").submit()});