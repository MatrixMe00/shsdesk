function payWithPaystack(){cust_amount=$("#pay_amount").val().split(" "),cust_amount=100*parseInt(cust_amount[1]),cust_email=$("form[name=paymentForm] .body #pay_email").val(),""==cust_email&&(cust_email="successinnovativehub@gmail.com"),$("#pay_fullname").val().toLowerCase().includes("shsdesk")?mykey="pk_test_3a5dff723cbd3fe22c4770d9f924d05c77403fca":mykey="pk_live_056157b8c9152eb97c1f04b2ed60e7484cd0d955";var e=PaystackPop.setup({key:mykey,email:cust_email,amount:cust_amount,currency:"GHS",metadata:{custom_fields:[{display_name:"Mobile Number",variable_name:"mobile_number",value:$("#pay_phone").val()},{display_name:"Customer's Name",variable_name:"customer_name",value:$("#pay_fullname").val()}]},callback:function(e){payment_received=!0,passPaymentToDatabase(e.reference),transaction_reference=e.reference},onClose:function(){alert_box("Transaction has been canceled by user","secondary",10)}});e.openIframe()}function trackTransactions(e=""){return reference_parsed||(fullname=$("#pay_fullname").val(),email=$("#pay_email").val(),phone=$("#pay_phone").val(),amount=$("#pay_amount").val().split(" "),amount=amount[1],deduction=parseFloat(((.0195+Number.EPSILON)*parseInt(amount)).toFixed(2)),school_name=$("#school_admission_case #school_select option:selected").html(),school_id=$("#student #school_admission_case label #school_select").val(),school_id>0&&(dataString="transaction_id="+e+"&contact_number="+phone+"&school="+school_id+"&amount="+amount+"&deduction="+deduction+"&contact_email="+email+"&contact_name="+fullname+"&submit=trackTransaction",$.ajax({url:$("form[name=paymentForm]").attr("action"),type:"POST",dataType:"text",data:dataString,cache:!1,async:!1,success:function(a){a.includes("success")?($("#ad_transaction_id").val(e),reference_parsed=!0,message="Form could not open automatically. Please enter your transaction reference to open it.",messageBoxTimeout("paymentForm",message,"load",0)):a.includes("already-exist")&&(reference_parsed=!0)},error:function(e){e=JSON.parse(JSON.stringify(e)),message=e.statusText,$("#pay_fullname, #pay_email, #pay_phone").prop("disabled",!0),$("#pay_reference").prop("disabled",!1),messageBoxTimeout("paymentForm",message,"error"),exit(1)}}))),reference_parsed}function reCheck(){""!=transaction_reference&&(reference_parsed=trackTransactions(transaction_reference)),reference_parsed&&(console.log(transaction_reference+" successfully captured"),reference_parsed=!1,payment_received=!1,transaction_reference="",clearInterval(trackKeeper))}function sendSMS(e){phone=$("#pay_phone").val().replace("+",""),message="Your payment was successful. Your transaction reference is "+e+". You can use this if you experience a problem while filling your form and would want to try again",dataString="submit=sendTransaction&phone="+phone+"&message="+message,$.ajax({url:"sms/sms.php",data:dataString,type:"POST",dataType:"json",success:function(a){response1=JSON.parse(JSON.stringify(a)),"success"==response1.status?alert_box("SMS sent successfully","success",8):alert_box("An sms could not be sent, but payment was successful. Your transaction reference is "+e+". Save this value at a safe place","warning",10)},error:function(){alert_box("An error occured while sending sms, but payment was successful. Your transaction reference is "+e+". Save this value at a safe place","warning",15)}})}function passPaymentToDatabase(e){fullname=$("#pay_fullname").val(),email=$("#pay_email").val(),phone=$("#pay_phone").val(),amount=$("#pay_amount").val().split(" "),amount=amount[1],deduction=parseFloat(((.0195+Number.EPSILON)*parseInt(amount)).toFixed(2)),school_name=$("#school_admission_case #school_select option:selected").html(),school_id=$("#student #school_admission_case label #school_select").val(),school_id>0&&(dataString="transaction_id="+e+"&contact_number="+phone+"&school="+school_id+"&amount="+amount+"&deduction="+deduction+"&contact_email="+email+"&contact_name="+fullname+"&submit=add_payment_data",$.ajax({url:$("form[name=paymentForm]").attr("action"),type:"POST",dataType:"text",data:dataString,cache:!1,async:!1,success:function(a){a.includes("success")?($("#ad_transaction_id").val(e),sendSMS(e),cont=a.split("-")[1],html="<p style='text-align: center; font-size: small; color: #666'>Finding trouble? Contact the admin via <a href='tel:"+cont+"' style='color: blue'>"+cont+"</a></p>",$("#admission #form_footer").html(html),$("#ad_index").val($("#student_index_number").val()),$("#ad_index").blur(),$("button[name=continue]").prop("disabled",!1).click(),trackKeeper=setInterval(reCheck,3e3),$("#admission").removeClass("no_disp"),message="Transaction was made successfully",messageBoxTimeout("paymentForm",message,"success")):"database_send_error"==a?(form_name="paymentForm",message="An error was encountered! Please try again in a short while with your reference id",message_type="error",time=10,messageBoxTimeout(form_name,message,message_type,time)):(form_name="paymentForm",message="An error was encountered while we tried to process your data. Please try again later.",message_type="error",time=10,messageBoxTimeout(form_name,message,message_type,time))},error:function(){message="Error communicating with server. Check your connection, enter your transaction code and try again",$("#pay_fullname, #pay_email, #pay_phone").prop("disabled",!0),$("#pay_reference").prop("disabled",!1),messageBoxTimeout("paymentForm",message,"error"),exit(1)}}))}reference_parsed=!1,payment_received=!1,transaction_reference="",trackKeeper=null,$("form[name=paymentForm]").submit(function(){form_name="paymentForm",""==$("section#trans #pay_reference").val()?($("#pay_reference").prop("disabled",!0),$("#pay_fullname, #pay_email, #pay_phone").prop("disabled",!1),payWithPaystack()):($("#pay_fullname, #pay_email, #pay_phone").prop("disabled",!0).val(""),school_id=$("#student #school_admission_case label #school_select").val(),ref=$("section#trans #pay_reference").val(),dataString="reference_id="+ref+"&submit=checkReference&school_id="+school_id,$.ajax({url:$("form[name=paymentForm]").attr("action"),data:dataString,type:"POST",dataType:"text",cache:!1,beforeSend:function(){message=loadDisplay({size:"small",animation:"anim-fade anim-swing"}),messageType="load",time=0,messageBoxTimeout(form_name,message,messageType,time)},success:function(e){e.includes("success")?($("form[name=admissionForm] #ad_transaction_id").val(ref),cont=e.split("-")[1],html="<p style='text-align: center; font-size: small; color: #666'>Finding trouble? Contact the admin via <a href='tel:"+cont+"' style='color: blue'>"+cont+"</a></p>",$("#admission #form_footer").html(html),$("#ad_index").val($("#student_index_number").val()),$("#ad_index").blur(),$("button[name=continue]").prop("disabled",!1).click(),$("#admission").removeClass("no_disp"),messageType="success",message="Verification was successful",time=5):"ref_expired"==e?(message="Sorry! This reference id has expired. Please make a new payment to continue",messageType="error",time=5):"error"==e?(message="Reference ID entered is incorrect. Please enter a valid id to continue",messageType="error",time=5):(message=e,messageType="error",time=0),messageBoxTimeout(form_name,message,messageType,time)},error:function(){message="Error communicating with server. Please check your internet connection and try again later",messageType="error",time=5,messageBoxTimeout(form_name,message,messageType,time)}}))}),$("#paymentFormButton").click(function(){$("form[name=paymentForm]").submit()});