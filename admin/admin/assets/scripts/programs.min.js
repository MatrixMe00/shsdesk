current_section=$("#lhs .item.active[data-tab]").attr("data-tab"),$(document).ready(function(){function e(e){const t=e.find("tr.secondary-i").length;e.find(".multi_button").prop("disabled",t<2),e.find(".de_select").toggleClass("no_disp",t<2),e.find("span.selected_rows").html(t)}ajaxCall_=null,$(".control_btn[data-section="+current_section+"]").click(),$("#courseIDs label input").change(function(){let e=$(this).prop("checked"),t=$(this).prop("value"),a=$(this).parents("form"),s=$(a).find("input[name=course_ids]").val();s=e?s.concat(t," "):s.replace(t+" ",""),a.find("input[name=course_ids]").val(s)}),$("form[name=addProgramForm]").submit(function(e){e.preventDefault();const t=jsonFormSubmit($(this),$(this).find("button[name=submit]"));t.then(e=>{e=JSON.parse(JSON.stringify(e)),messageBoxTimeout($(this).prop("name"),e.message,e.status?"success":"error"),!0===e.status&&(num=parseInt($(".content.orange").find("h2").html())+1,$(".content.orange").find("h2").html(num),$("#viewAll").attr("data-refresh","true"),setTimeout(()=>{$(this).find("input:not([type=checkbox], [name=school_id])").val(""),$(this).find("input[type=checkbox]").prop("checked",!1)},3e3))})}),$(".control_btn").click(function(){const e=$(this).attr("data-section");$(".section_box:not(.no_disp)").addClass("no_disp"),$("#lhs .item.active").attr("data-tab",e),$("#"+$(this).attr("data-section")).removeClass("no_disp"),$(".control_btn:not(.plain)").addClass("plain"),$(this).removeClass("plain"),$(this).attr("data-refresh")&&"true"===$(this).attr("data-refresh")&&$("#lhs.menu .item.active").click()}),$(".item-event").click(function(){if(item_id=$(this).parents("tr").attr("data-item-id"),$(this).hasClass("edit"))$("#updateProgram").removeClass("no_disp"),ajaxCall_=$.ajax({url:$("#updateProgram form").attr("action"),data:{program_id:item_id,submit:"getProgram"},timeout:3e4,beforeSend:function(){$("#updateLoader").toggleClass("no_disp flex"),$("#updateProgram #getLoader").html(loadDisplay({circular:!0,circleColor:"light"}))},success:function(e){$("#updateProgram #getLoader").html(""),$("#updateProgram #getLoader").toggleClass("no_disp flex"),$("#updateProgram form").removeClass("no_disp"),e=JSON.parse(JSON.stringify(e));const t=e.results;if(!0===e.status){const e=t.course_ids.split(" ");""==e[e.length-1]&&e.pop(),$("#updateProgram input[name=program_id]").val(t.program_id),$("#updateProgram input[name=program_name]").val(t.program_name),$("#updateProgram input[type=checkbox]").each((t,a)=>{element_val=$(a).val(),!0===e.includes(element_val)&&$(a).prop("checked",!0)}),$("#updateProgram input[name=short_form]").val(t.short_form),$("#updateProgram input[name=course_ids]").val(t.course_ids)}else alert(t)},error:function(e,t){let a="";a="timeout"===t?"Connection was timed out due to a slow network. Please check your internet connection and try again":"parsererror"===t?"Status: Data returned cannot be parsed. Please try again later else contact admin for help":"Status: "+e.responseText,alert_box(a,"warning color-dark",10)}});else if($(this).hasClass("delete")){let e=$(this).parents("tr").children("td:nth-child(2)").html();$("#table_del").removeClass("no_disp"),$("#table_del p#warning_content").html("Do you want to remove <b>"+e+"</b> from your records?"),$("#delete_form input[name=item_id]").val(item_id),$("#delete_form input[name=table_name]").val("program"),$("#delete_form input[name=db]").val("shsdesk2"),$("#delete_form input[name=column_name]").val("program_id"),$(this).parents("tr").addClass("remove_marker")}else if($(this).hasClass("approve")||$(this).hasClass("reject")){const e=$(this).hasClass("approve")?"accepted":"rejected",t=$(this).parents("table").find("tfoot"),a=$(this).parents("tr");$.ajax({url:$("#updateProgram form").attr("action"),data:{record_token:item_id,record_status:e,submit:"result_status_change"},type:"POST",dataType:"json",timeout:3e4,cache:!1,beforeSend:function(){$(t).addClass("sticky top secondary w-full"),$(t).find(".res_stat").html("Status: Updating...")},success:function(e){$(t).removeClass("sticky top secondary w-full"),e.status,!0===e.status?($(a).remove(),$(t).find(".res_stat").html("The record was "+e.rec_stat),$("#lhs .item.active").click()):$(t).find(".res_stat").html(e.message)},error:function(e,a){let s="";s="timeout"===a?"Status: Connection was timed out. Please check your network connection and try again":"parsererror"===a?"Status: Data returned cannot be parsed. Please try again later else contact admin for help":"Status: "+e.responseText,$(t).find(".res_stat").html(s)}})}else if($(this).hasClass("view")){$("#view_results").removeClass("no_disp");const e=$(this).parents("tr"),t=e.find("td.program_name").html(),a=e.find("td.course_name").html(),s=e.find("td.exam_year").html(),r=e.find("td.semester").html();$("#view_results table tfoot #year_sem").html("Class Year: "+s+" | Class Sem: "+r),$("#view_results #topic").html(a+" results for "+t),$.ajax({url:"./admin/submit.php",data:{submit:"view_results",token_id:item_id},timeout:3e4,beforeSend:function(){const e="<tr class='empty'><td colspan='6'>Fetching results, please wait...</td></tr>";$("#view_results table tbody").html(e)},success:function(e){if(e=JSON.parse(JSON.stringify(e)),$("#view_results table tbody").html(""),e.error){const t="<tr class='empty'><td colspan='6'>"+e.message+"</td></tr>";$("#view_results table tbody").html(t)}else{const t=e.message;t.forEach(e=>{const t='<tr data-belongs-to="'+item_id+'">\n<td class="index_number">'+e.indexNumber+'</td>\n<td class="fullname">'+e.fullname+'</td>\n<td class="class_mark">'+e.class_mark+'</td>\n<td class="exam_mark">'+e.exam_mark+'</td>\n<td class="total_mark">'+e.mark+'</td>\n<td class="grade">'+e.grade+'</td>\n<td class="position">'+e.position+"</td>\n"+(e.can_remove?'<td><span class="item-event remove-score" data-item-id="'+e.id+'">Remove</span></td>\n':"")+"</tr>\n";$("#view_results table tbody").append(t)})}},error:function(e){let t=e.responseText;"timeout"==e.textStatus&&(t="Server communication was halted due to slow network. Please check your network and try again"),alert_box(t,"danger",7)}})}else if($(this).hasClass("remove")){let e=$(this).parents("tr").children("td:nth-child(2)").html(),t=$(this).parents("tr").children("td:nth-child(3)").html();$("#table_del").removeClass("no_disp"),$("#table_del p#warning_content").html("Do you want to remove <b>"+t+"</b> uploaded for <b>"+e+"</b> from your records?"),$("#delete_form input[name=item_id]").val(item_id),$("#delete_form input[name=table_name]").val("recordapproval"),$("#delete_form input[name=column_name]").val("result_token"),$("#delete_form input[name=db]").val("shsdesk2"),$(this).parents("tr").addClass("remove_marker")}}),$("body").on("click",".remove-score",function(){const e=$(this).parents("tr"),t=$(this).attr("data-item-id"),a=e.attr("data-belongs-to"),s=e.find("td.fullname").html();$("#table_del p#warning_content").html("Do you want to remove <b>"+s+"</b> from this record data?"),$("#delete_form input[name=item_id]").val(t+"-"+a),$("#delete_form input[name=table_name]").val("results"),$("#delete_form input[name=db]").val("shsdesk2"),$("#delete_form input[name=column_name]").val("id"),e.addClass("remove_marker"),$("#table_del").removeClass("no_disp")}),$("form[name=delete_form]").submit(function(e){e.preventDefault();const t=formSubmit($(this),null,!1);!0===t||"true"===t?($("tr.remove_marker").remove(),alert_box("Data deleted successfully","success"),$("#table_del").addClass("no_disp")):($("tr.remove_marker").removeClass("remove_marker"),console.log(t))}),$("#cancelUpdate").click(function(){ajaxCall_?ajaxCall_.abort():alert("no ajax"),$("#updateProgram").addClass("no_disp")}),$("form[name=updateProgramForm]").submit(function(e){e.preventDefault();const t=jsonFormSubmit($(this),$(this).find("button[name=submit]"));t.then(e=>{e=JSON.parse(JSON.stringify(e)),messageBoxTimeout($(this).prop("name"),e.message,e.status?"success":"error"),!0!==e.status&&"true"!==e.status||$("button.control_btn").attr("data-refresh","true"),"addCourseForm"===$("form").prop("name")&&e.isFirst&&(location.href=location.href)})}),$("label.search-label input[name=search]").keyup(function(){const e=$(this).parents("label"),t=$("#"+e.attr("data-table")),a=t.find("tbody"),s=$(this).val().toLowerCase();if(""!==s){$(a).children("tr").each(function(){const e=$(this).text().toLowerCase();-1===e.indexOf(s)?$(this).addClass("no_disp"):$(this).removeClass("no_disp")});const e=a.children("tr:visible");0===e.length&&alert_box("No results were returned","secondary")}else a.children("tr.no_disp").removeClass("no_disp")}),$("#academic_year_select").change(function(){const e=$("#"+$(this).attr("data-table-id")),t=e.find("td.academic_year"),a=$(this).val().toLowerCase();""!==a?t.each(function(e,t){const s=$(t).parents("tr");$(t).text().toLowerCase()==a?s.addClass("no_disp"):s.removeClass("no_disp")}):t.each(function(e,t){const a=$(t).parents("tr");a.removeClass("no_disp")})}),$("tbody td:not(.options)").click(function(){const t=$(this).parent(),a=$(this).parents("section").first();t.toggleClass("secondary-i"),e(a)}),$(".de_select").click(function(){const t=$(this).parents("section").first();t.find("tr.secondary-i").removeClass("secondary-i"),e(t)}),$(".multi_button").click(async function(){const t=$(this);t.siblings("button").prop("disabled",!0);const a=t.attr("data-event"),s=t.parents("section").first(),r=s.find("tbody tr.secondary-i"),n=confirm("Are your sure you want to "+a+" these "+r.length+" rows?"),o=t.html();if(n){const n={};let i="";"approve"==a||"reject"==a?(n.submit="result_status_change",n.record_status="approve"==a?"accepted":"rejected",i="record_token"):"delete"==a&&(n.submit="delete_item",n.table_name=t.attr("data-table"),n.column_name=t.attr("data-del-col"),n.db="shsdesk2",i="item_id");const l=r.length;for(let e=0;e<l;e++){const s=$(r[e]),o=s.attr("data-item-id");n[i]=o;const l=await ajaxCall({url:"./admin/submit.php",formData:n,returnType:"delete"==a?"text":"json",method:"delete"==a?"GET":"POST",beforeSend:function(){t.html("Processing ["+(e+1)+"]").attr("disabled",!0)}});"success"===l?s.remove():!0===l.status?"reject"==a?s.addClass("red-i").removeClass("secondary-i"):s.removeClass("red-i secondary-i"):alert_box("delete"==a?l:l.message)}alert_box("Changes were successful","success"),await delay(2e3),t.html(o),e(s),"approve"!=a&&"reject"!=a||$("#lhs .item.active").click()}})});